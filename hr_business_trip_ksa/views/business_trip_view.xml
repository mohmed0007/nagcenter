<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="bt_tree_view" model="ir.ui.view">
        <field name="name">bt.tree.view</field>
        <field name="model">business.trip</field>
        <field name="arch" type="xml">
            <tree string="Business Trip" sample="1">
                <field name="employee_id" widget="many2one_avatar_employee"/>
                <field name="transportation_type"/>
                <field name="source"/>
                <field name="destination"/>
                <field name="departure_date"/>
                <field name="arrival_date"/>
                <field name="total_expense"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="bt_form_view" model="ir.ui.view">
        <field name="name">business.trip.form.view</field>
        <field name="model">business.trip</field>
        <field name="arch" type="xml">
            <form string="Business Trip">
                <header>
                    <button name="bt_confirm" string="Confirm"
                            states="draft" type="object" class="oe_highlight" groups="base.group_user"/>
                    <button name="bt_validate" string="Validate"
                            states="confirm" type="object" groups="hr.group_hr_user" class="oe_highlight"/>
                    <button name="bt_validate1" string="HR Approve"
                            states="validate" type="object" groups="hr.group_hr_user" class="oe_highlight"/>
                    <button name="bt_approved" string="Approve"
                            states="validate1" type="object" groups="hr.group_hr_manager" class="oe_highlight"/>
                    <button string="Create or View Ticket Request" name="create_ticket_request"
                            type="object" attrs="{'invisible': [('transportation_type', '!=', 'flight')]}"/>
                    <button string="Create or View Visa Request" name="create_visa_request"
                            type="object" attrs="{'invisible': [('visa_required', '=', False)]}"/>
                    <button string="Create Advance Payment" name="create_advance_payment"
                            type="object" context="{'advance_payment': True}"
                            attrs="{'invisible': ['|', ('advance_required', '=', False), ('advance_payment_id', '!=', False)]}"
                            groups="hr.group_hr_manager"/>
                    <button string="Generate Payment" name="create_advance_payment"
                            type="object" states="approved" groups="hr.group_hr_manager"/>
                    <button name="bt_refuse" string="Refuse"
                            states="confirm,validate,validate1,approved" groups="hr.group_hr_user"
                            type="object"/>
                    <button name="set_draft" string="Set as Draft" states="refuse" type="object"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirm,validate"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" class="oe_inline" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Employee Information" groups="hr.group_hr_user">
                            <field name="employee_id" Placeholder="Select Employee..."
                                   attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="department_id" force_save="1"/>
                            <field name="job_id" force_save="1"/>
                            <field name="branch_id" force_save="1"/>
                            <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"
                                   attrs="{'readonly':[('state','!=','draft')]}" force_save="1"/>
                        </group>
                        <group string="Trip Details">
                            <field name="transportation_type" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="source" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="destination" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="departure_date" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="arrival_date" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="no_of_days" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="no_of_night" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="cost_center"/>
                            <field name="advance_required"/>
                            <field name="visa_required"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Description" name="description">
                            <field name="description" placeholder="Put the description here"
                                   attrs="{'readonly':[('state','!=','draft')]}"/>
                        </page>
                        <page string="Accounting" name="per_diem" groups="hr.group_hr_manager">
                            <group>
                                <group>
                                    <field name="per_diem_amount" force_save="1" readonly="1"/>
                                    <field name="estimated_amount"/>
                                    <field name="advance_payment_id" force_save="1" readonly="1"/>
                                    <field name="payment_entry_id" force_save="1" readonly="1"/>
                                </group>
                                <group>
                                    <field name="advance_amount" force_save="1" readonly="1"/>
                                    <field name="adjustment_amount" force_save="1" readonly="1"/>
                                    <field name="total_expense" force_save="1" readonly="1"/>
                                </group>
                            </group>

                        </page>
                        <page string="Other Information" groups="base.group_no_one">
                            <group col="4">
                                <field name="create_uid" readonly="1" attrs="{'invisible':[('create_uid','=',False)]}"/>
                                <field name="create_date" readonly="1"
                                       attrs="{'invisible':[('create_date','=',False)]}"/>
                                <field name="write_uid" readonly="1" attrs="{'invisible':[('write_uid','=',False)]}"/>
                                <field name="write_date" readonly="1" attrs="{'invisible':[('write_date','=',False)]}"/>
                                <field name="approved_by" attrs="{'invisible':[('approved_by','=',False)]}"/>
                                <field name="approved_date" attrs="{'invisible':[('approved_date','=',False)]}"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="bt_filter" model="ir.ui.view">
        <field name="name">bt.select</field>
        <field name="model">business.trip</field>
        <field name="arch" type="xml">
            <search string="Filter">
                <filter name="draft" string="Draft" domain="[('state','=',('draft'))]"/>
                <filter name="confirm" string="Waiting Approval" domain="[('state','=',('confirm'))]"/>
                <filter name="validate" string="Validated" domain="[('state','=',('validate'))]"
                        help="Business Request Validated"/>
                <filter name="validate1" string="HR Approve" domain="[('state','=',('validate1', 'approved'))]"/>
                <filter name="refused" string="Refused" domain="[('state','=',('refuse'))]"
                        help="Business Trip has been refused"/>
                <field name="state"/>
                <group expand="0" string="Group By...">
                    <filter name="group_employee" string="Employee" context="{'group_by':'employee_id'}"/>
                    <filter name="group_job" string="Job Position" context="{'group_by':'job_id'}"/>
                    <filter name="group_department" string="Department" context="{'group_by':'department_id'}"/>
                    <filter name="group_transportation_type" string="Transportation Type"
                            context="{'group_by':'transportation_type'}"/>
                    <filter name="group_source" string="Source" context="{'group_by':'source'}"/>
                    <filter name="group_destination" string="Destination" context="{'group_by':'destination'}"/>
                    <filter name="group_state" string="State" context="{'group_by':'state'}"/>
                    <filter name="group_departure_date" string="Month" context="{'group_by':'departure_date'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_bt_view" model="ir.actions.act_window">
        <field name="name">Business Trip</field>
        <field name="res_model">business.trip</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_bt"
              parent="hr_employee_updation.menu_operation_request"
              name="Business Trip"
              action="action_bt_view"
              sequence="12"
              groups="base.group_user"
    />


</odoo>